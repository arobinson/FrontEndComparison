<div class="product-list-container">
  <div class="header-row">
    <h1>Products</h1>
    <button class="reset-button" (click)="resetFilters()" type="button">
      Reset Filters
    </button>
  </div>

  @if (isLoading() && !hasData()) {
    <p>Loading products...</p>
  } @else if (hasData()) {
    @if (isLoading()) {
      <div class="loading-indicator">‚è≥ Loading...</div>
    }
    <aff-data-table
      [columns]="columns"
      [value]="currentPageData()"
      [totalPages]="totalPages()"
      [(page)]="currentPage"
      [(pageSize)]="pageSize"
      [pageSizes]="[10, 25, 50]"
      [renderFilter]="true"
    >
      <ng-template #header let-column>
        <strong>{{ getColumnTitle(column) }}</strong>
      </ng-template>

      <ng-template #filter let-column>
        @switch (getColumnDataType(column)) {
          @case ("progress-bar") {
            <aff-range-slider
              [min]="0"
              [max]="100"
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
          @case ("grade-badge") {
            <aff-multi-select
              [options]="['A', 'B', 'C', 'D', 'F']"
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
          @case ("nova-dots") {
            <aff-multi-select
              [options]="['1', '2', '3', '4']"
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
          @case ("large-counter") {
            <aff-range-slider
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
          @case ("boolean-yesno") {
            <aff-multi-select
              [options]="['Yes', 'No']"
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
          @case ("product-image") {
            <!-- No filter for images -->
          }
          @default {
            <aff-text-search
              [resetTrigger]="filterResetTrigger()"
              (valueChange)="updateFilter(column, $event)"
            />
          }
        }
      </ng-template>

      <ng-template #data let-value let-column="column" let-row="row">
        @switch (getColumnDataType(column)) {
          @case ("product-link") {
            <aff-product-link [value]="value" />
          }
          @case ("progress-bar") {
            <aff-progress-bar [value]="value" />
          }
          @case ("grade-badge") {
            <aff-grade-badge [value]="value" />
          }
          @case ("nova-dots") {
            <aff-nova-dots [value]="value" />
          }
          @case ("truncated-text") {
            <aff-truncated-text [value]="value" />
          }
          @case ("large-counter") {
            <aff-large-counter [value]="value" />
          }
          @case ("boolean-yesno") {
            <aff-boolean-yesno [value]="value" />
          }
          @case ("product-image") {
            <aff-product-image [value]="value" />
          }
          @case ("decimal-units") {
            <aff-decimal-units [value]="value" />
          }
          @case ("absolute-date") {
            <aff-absolute-date [value]="value" />
          }
          @case ("relative-date") {
            <aff-relative-date [value]="value" />
          }
          @case ("time-format") {
            <aff-time-format [value]="value" />
          }
          @default {
            {{ value || "" }}
          }
        }
      </ng-template>
    </aff-data-table>
  } @else if (isError()) {
    <p>Error loading products: {{ productsResource.error() }}</p>
  } @else {
    <p>No products found.</p>
  }
</div>
